var build=build||{},Build=build.Build=function(){function a(r){switch(typeof r){case "function":a.onload.apply(a.onload,arguments);break;case "string":a.define.apply(a.define,arguments)}}function d(r,b){for(var a=r.split("."),u=t.root,e=u,c="",d=0,f=a.length;d<f;d++)c=a[d],u[c]=u[c]||{},e=u,u=u[c];D[a[0]]=t.root[a[0]];return e[c]=b}function h(r,b){for(var a in b)b.hasOwnProperty(a)&&(r[a]=r[a]||b[a]);return r}function b(b,a){for(var e in a)a.hasOwnProperty(e)&&(b[e]=a[e]);return b}function f(a,e,
c){e?(c=c||{},Object.keys(a.prototype).length&&b(c,a.prototype),a.prototype=Object.create(e.prototype),b(a.prototype,c),a.prototype.constructor=a,h(a,e),a.$parent=e):h(a.prototype,c)}function s(a,b,e,c,l,s){$construtor=s?singletone(b):b;h(b,c);f(b,l,e);b.$name=a;v[a]=b;d(a,b);return b}function e(){for(var a=Object.keys(w);a.length;){var b=a.pop();l(b)}w={};y&&(k.queue.call(),k.queue.clear())}function l(a){var b=w[a];delete w[a];if(b){var e;b(function(b){v[b.$extends]||l(b.$extends);e=s(a,b.$constructor,
b.$prototype,b.$static,v[b.$extends],b.$singleton)},function(b){return function(){e.$parent.apply(b,Array.prototype.slice.call(arguments))}})}}function q(b){return b.replace(/\./g,"-")}function n(b,a){return b.endsWith(".js")?a+name:a+b.replace(/\./g,"/")+".js"}function p(){this.done=!1;this.queue=[]}function m(b,a){function d(){Object.keys(z).length||e();m.queue.call();m.queue.clear()}m.queue.add(a);if(b instanceof Array){A+=b.length;for(var f=0,l=b.length;f<l;f++)c(b[f],function(){A--;A||d()})}else c(b,
d)}function c(b,a){var e,c=b.split("::");1<c.length?(e=B[c[0]]||B.main,b=c[1]):e=B.main;v[b]?a():(e=n(b,e),c=q(b),z[b]=!0,g(c,e,function(){delete z[b];a()}))}function g(b,e,c){switch(t.name){case "browser":var d=document.createElement("script");d.id=b;d.src=e;d.addEventListener("load",c,!1);document.getElementsByTagName("head")[0].appendChild(d);break;case "node":b=require(e),t.override&&"function"!==typeof b||b(a),c()}}function k(b){if("undefined"!=typeof jQuery)jQuery(b);else if(k.queue)k.queue.add(b);
else switch(k.queue=new p,k.queue.add(b),t.name){case "browser":window.addEventListener("load",function(){y=!0;var b=Object.keys(C);b.length?m(b,function(){e()}):e()},!1);break;case "node":e()}}var y=!1,z={},w={},B={main:"/"},C={},D={},t=function(){return"undefined"!==typeof window?{name:"browser",root:window}:"undefined"!==typeof process?(y=!0,module.exports=a,{name:"node",root:D,override:"hidden",processOverride:function(){this.root=process;this.override="process";process.Build=a},globalOverride:function(){this.root=
GLOBAL;this.override="global";GLOBAL.Build=a}}):{name:null,root:null}}(),v={};p.prototype={add:function(b){this.done?b():this.queue.push(b)},call:function(){if(!this.done){for(;this.queue.length;)this.queue.pop()();this.done=!0}},clear:function(){this.done=!1;this.queue=[]}};var A=0;m.queue=new p;k.queue=null;a.root=D;a.environment=t;a.namespace=d;a.copyReplace=b;a.copyNoReplace=h;a.inherit=f;a.singleton=function(b){var a=void 0;return function(){if(!a){var e=arguments,c=function(){return b.apply(this,
e)};c.prototype=b.prototype;a=new c}return a}};a.definitions=v;a.assemble=s;a.paths=B;a.define=function(b,a,e){y||delete C[b];for(var c=[],d=0,f=a.length;d<f;d++){var l=a[d];v[l]||(w[l]||z[l]||C[l])||c.push(l)}w[b]=e;if(c.length)if(y)m(c,function(){});else for(d=0,f=c.length;d<f;d++)C[c[d]]=!0};a.nameToCss=q;a.nameToFileName=n;a.load=m;a.loadScript=g;a.CallbackQueue=p;a.onload=k;return a}();
(function(){"function"!==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)})})();var fs=require("fs"),path=require("path");
module.exports=function(a){a("build.mvc.Controller",[],function(d,$super){a.root.system.controllers={};d({$constructor:function(){},$prototype:{},$static:{loadControllers:function(b){var a=fs.readdirSync(b);for(x in a){var d=a[x];if(".js"==path.extname(d)){var e=path.basename(d,".js");this.load(e,b+"/"+d)}}},load:function(b,a){var d=this;require(a)(system,function(a,d,f){a.prototype=d||{};for(var s in f)a.prototype[s]=f[s];system.controllers[b]=a;console.log("Added controller:  "+b)},function(b){b.verb=
b.verb||"all";b.permission=b.permission||null;b.restful=b.restful||!1;if(!b.route||!b.method)throw"missing parameters in route";var a=b.permission,f=b.verb,n=b.route,p=b.method,m=function(c,f){a?Array.isArray(a)||(a=[a]):a=[];for(var g=0;g<a.length;g++){var k=a[g];"string"==typeof k&&(a[g]=system.permission[k])}k=!0;for(g=0;g<a.length&&(k=a[g],k=k(c,f),k);g++);k?b.restful?(g=function(b){f.send(b)},p(c,f,g)):(k={layout:"layoutMain",title:"",instance:{request:c,response:f},main:{}},g=function(b,a){a.widgets?
d.renderWidgets(c,f,a.widgets,function(c){a.widgets=c;f.render(b,a)}):f.render(b,a)},p(c,f,g,k)):f.send(!1)};"string"==typeof f&&(f=[f]);"string"==typeof n&&(n=[n]);for(var c=0;c<n.length;c++)for(var g=n[c],k=0;k<f.length;k++)switch(f[k]){case "all":system.app.all(g,m);break;case "get":system.app.get(g,m);break;case "post":system.app.post(g,m);break;case "put":system.app.put(g,m);break;case "delete":system.app.del(g,m)}return p})},renderWidgets:function(b,a,d,e){e(d)}}})})};var fs=require("fs"),path=require("path"),mongo=require("mongodb"),mongoose=require("mongoose"),Server=mongo.Server,Db=mongo.Db;
module.exports=function(a){a("build.mvc.Database",[],function(a,$super){a({$constructor:function(b,a,d,e,l){this.server=this.db=null;var q=this;this.init=function(n){var p=q.initMongo(b,a,d,e,l,function(){q.initMongoose(function(){"function"==typeof n?n():!1})});q.db=p.db;q.server=p.server}},$static:{initMongo:function(b,a,d,e,l,q){b=new Server(b,a,{auto_reconnect:!0});d=new Db(d,b,{safe:!1});d.open(function(b,a){a.authenticate(e,l,function(){b?console.log("Database connection failure..."):(console.log("Database connection success..."),
q())})});return{server:b,db:d}},initMongoose:function(b){mongoose.connection.on("open",function(){console.log("Mongoose connection success...");b()});mongoose.connect(system.config.mongooseConnection)}}})})};fs=require("fs");path=require("path");module.exports=function(a){a.helpers={};return{loadHelpers:function(a){var h=fs.readdirSync(a);for(x in h){var b=h[x];if(".js"==path.extname(b)){var f=path.basename(b,".js");this.load(f,a+"/"+b)}}},load:function(d,h){require(h)(a,function(b,f){a.helpers[b]=f;console.log("Added helper:  "+d)})}}};fs=require("fs");path=require("path");module.exports=function(a){a.models={};return{loadModels:function(a){var h=fs.readdirSync(a);for(x in h){var b=h[x];if(".js"==path.extname(b)){var f=path.basename(b,".js");this.load(f,a+"/"+b)}}},load:function(d,h){require(h)(a,function(b){a.models[d]=b;console.log("Added model:  "+d)})}}};fs=require("fs");path=require("path");module.exports=function(a){a.permission={};return{loadPermissions:function(a){var h=fs.readdirSync(a);for(x in h){var b=h[x];if(".js"==path.extname(b)){var f=path.basename(b,".js");this.load(f,a+"/"+b)}}},load:function(d,h){require(h)(a,function(b,f){a.permission[b]=f;console.log("Added permission:  "+d)})}}};var express=require("express"),expressLayouts=require("express-ejs-layouts"),engine=require("ejs-locals"),mongoStore=require("connect-mongo")(express),fs=require("fs"),path=require("path"),url=require("url"),ejs=require("ejs"),async=require("async");
module.exports=function(a){a("build.mvc.Server","build.mvc.Database build.mvc.Permission build.mvc.Helper build.mvc.Widget build.mvc.Controller build.mvc.Model".split(" "),function(a,$super){a({$constructor:function(b){function a(c){l.loadPermissions(b.permissionPath);q.loadHelpers(g.config.helperPath);n.loadWidgets(g.config.widgetPath);p.loadControllers(b.controllerPath);m.loadModels(b.modelPath);c()}function d(a){c.listen(b.port,function(){console.log("Listening on port "+b.port);"function"==typeof a?
a():!1})}var e=build.mvc.Database,l=build.mvc.Permission,q=build.mvc.Helper,n=build.mvc.Widget,p=build.mvc.Controller,m=build.mvc.Model;this.config=b=require("./config");var c=express(),g={};g.app=c;g.config=b;c.configure(function(){c.engine("ejs",engine);c.set("views",b.viewPath);c.set("view engine","ejs");c.set("layout","layout");c.set("view options",{pretty:!0});c.use(express.compress());c.use(expressLayouts);c.use(b.staticDirectory,express.static(b.staticPath));c.use(express.favicon(b.icon));
c.use(express.logger("dev"));c.use(express.bodyParser());c.use(express.methodOverride());c.use(express.cookieParser(b.cookieSecret));c.use(express.session({secret:b.session.cookieSecret,store:new mongoStore(b.session.database,function(){console.log("Session database connection success...")}),maxAge:b.session.maxAge}));c.use(c.router)});c.configure("development",function(){c.use(express.errorHandler({dumpExceptions:!0,showStack:!0}))});c.configure("production",function(){c.use(express.errorHandler())});
c.locals.Html={};e=e(g);l=l(g);q=q(g);n=n(g);p=p(g);m=m(g);e.initialize(function(){a(function(){d()})})},$prototype:{},$static:{}})})};fs=require("fs");path=require("path");module.exports=function(a){a.widgets={render:function(a,h,b){}};return{loadWidgets:function(a){var h=fs.readdirSync(a);for(x in h){var b=h[x];if(".js"==path.extname(b)){var f=path.basename(b,".js");this.load(f,a+"/"+b)}}},load:function(d,h){require(h)(a,function(b,f){a.helpers[b]=f;console.log("Added widget:  "+d)},function(b,d,h){fs.readFile(a.config.viewPath+b+".ejs",function(a,b){a?"function"==typeof h?h(a):!1:"function"==typeof h?h(null,ejs.render(b,d)):!1})})}}};Build("build.NodeTest",[],function(a,$super){a({$constructor:function(){console.log("NodeTest")}})});
