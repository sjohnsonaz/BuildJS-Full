var build=build||{},Build=build.Build=function(){function a(d){switch(typeof d){case "function":a.onload.apply(a.onload,arguments);break;case "string":a.define.apply(a.define,arguments)}}function g(d,b){for(var a=d.split("."),f=p.root,c=f,e="",g=0,h=a.length;g<h;g++)e=a[g],f[e]=f[e]||{},c=f,f=f[e];z[a[0]]=p.root[a[0]];return c[e]=b}function f(d,b){for(var a in b)b.hasOwnProperty(a)&&(d[a]=d[a]||b[a]);return d}function d(d,b){for(var a in b)b.hasOwnProperty(a)&&(d[a]=b[a]);return d}function b(b,a,
c){a?(c=c||{},Object.keys(b.prototype).length&&d(c,b.prototype),b.prototype=Object.create(a.prototype),d(b.prototype,c),b.prototype.constructor=b,f(b,a),b.$parent=a):f(b.prototype,c)}function c(d,a,c,e,h,t){$construtor=t?singletone(a):a;f(a,e);b(a,h,c);a.$name=d;q[d]=a;g(d,a);return a}function e(){for(var d=Object.keys(r);d.length;){var b=d.pop();t(b)}r={};s&&(h.queue.call(),h.queue.clear())}function t(d){var b=r[d];delete r[d];if(b){var a;b(function(b){q[b.$extends]||t(b.$extends);a=c(d,b.$constructor,
b.$prototype,b.$static,q[b.$extends],b.$singleton)},function(b){return function(){a.$parent.apply(b,Array.prototype.slice.call(arguments))}})}}function k(b){return b.replace(/\./g,"-")}function n(b,d){return b.endsWith(".js")?d+name:d+b.replace(/\./g,"/")+".js"}function m(){this.done=!1;this.queue=[]}function l(b,d){function a(){Object.keys(u).length||(e(),l.queue.call(),l.queue.clear())}l.queue.add(d);if(b instanceof Array){v+=b.length;for(var c=0,f=b.length;c<f;c++)A(b[c],function(){v--;v||a()})}else A(b,
a)}function A(b,d){var a,c=b.split("::");1<c.length?(a=w[c[0]]||w.main,b=c[1]):a=w.main;q[b]?d():(a=n(b,a),c=k(b),u[b]=!0,B(c,a,function(){delete u[b];d()}))}function B(b,d,c){switch(p.name){case "browser":var f=document.createElement("script");f.id=b;f.src=d;f.addEventListener("load",c,!1);document.getElementsByTagName("head")[0].appendChild(f);break;case "node":b=require(d),p.override&&"function"!==typeof b||b(a),c()}}function h(b){if("undefined"!=typeof jQuery)jQuery(b);else if(h.queue)h.queue.add(b);
else switch(h.queue=new m,h.queue.add(b),p.name){case "browser":window.addEventListener("load",function(){s=!0;var b=Object.keys(y);b.length?l(b,function(){e()}):e()},!1);break;case "node":e()}}var s=!1,u={},r={},w={main:"/"},y={},z={},p=function(){return"undefined"!==typeof window?{name:"browser",root:window}:"undefined"!==typeof process?(s=!0,module.exports=a,{name:"node",root:z,override:"hidden",processOverride:function(){this.root=process;this.override="process";process.Build=a},globalOverride:function(){this.root=
GLOBAL;this.override="global";GLOBAL.Build=a}}):{name:null,root:null}}(),q={};m.prototype={add:function(b){this.done?b():this.queue.push(b)},call:function(){if(!this.done){for(;this.queue.length;)this.queue.pop()();this.done=!0}},clear:function(){this.done=!1;this.queue=[]}};var v=0;l.queue=new m;h.queue=null;a.root=z;a.environment=p;a.namespace=g;a.copyReplace=d;a.copyNoReplace=f;a.inherit=b;a.singleton=function(b){var d=void 0;return function(){if(!d){var a=arguments,c=function(){return b.apply(this,
a)};c.prototype=b.prototype;d=new c}return d}};a.definitions=q;a.assemble=c;a.paths=w;a.define=function(b,d,a){s||delete y[b];for(var c=[],f=0,e=d.length;f<e;f++){var g=d[f];q[g]||(r[g]||u[g]||y[g])||c.push(g)}r[b]=a;if(c.length)if(s)l(c,function(){});else for(f=0,e=c.length;f<e;f++)y[c[f]]=!0};a.nameToCss=k;a.nameToFileName=n;a.load=l;a.loadScript=B;a.CallbackQueue=m;a.onload=h;return a}();
(function(){"function"!==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)})})();Build("build.HashRouter",[],function(a,$super){a({$constructor:function(){this.routes={}},$prototype:{handler:function(a){for(var d in routes)if(routes.hasOwnProperty(d)){var b=routes[d],c=a.newURL.match(b.regex);c&&b.enter.apply(b.enter,c.slice(1))}},listen:function(){window.addEventHandler("hashchange",this.handler)},stop:function(){window.removeEventHandler("hashchange",this.handler)},add:function(a,d,b){this.routes[a]={route:a,enter:d,exit:b,regex:RegExp(a.replace(/\//g,"\\/").replace(/:(\w*)/g,
"(\\w*)"))}},remove:function(a){delete this.routes[a]}}})});Build("build.ui.Application",["build.ui.Panel"],function(a,$super){a({$extends:"build.ui.Panel",$constructor:function(a){$super(this)(a)}})});Build("build.ui.form.Button",["build.ui.form.FormElement"],function(a,$super){a({$extends:"build.ui.form.FormElement",$constructor:function(a){$super(this)(a||"button")},$prototype:{build:function(){this.element.innerHTML="Button"}}})});Build("build.ui.form.Form",["build.ui.Panel"],function(a,$super){a({$extends:"build.ui.Panel",$constructor:function(a){$super(this)(a||"form")}})});Build("build.ui.form.FormElement",["build.ui.Widget"],function(a,$super){a({$extends:"build.ui.Widget",$constructor:function(a){$super(this)(a)},$prototype:{}})});Build("build.ui.form.Submit",["build.ui.form.Button"],function(a,$super){a({$extends:"build.ui.form.Button",$constructor:function(a){$super(this)(a||"submit")}})});Build("build.ui.Module",[],function(a,$super){a({$constructor:function(){}})});Build("build.ui.Panel",["build.ui.Widget"],function(a,$super){a({$extends:"build.ui.Widget",$constructor:function(a){$super(this)(a);this.children=[]},$prototype:{addChild:function(a){this.children.push(a);this.appendChild(a)},removeChild:function(a){this.children.splice(array.indexOf(a),1);this.removeChild(a)}}})});Build("build.ui.SwitcherPanel",["build.ui.Panel"],function(a,$super){a({$extends:"build.ui.Panel",$constructor:function(a){$super(this)(a);this.active=0},$prototype:{setActive:function(a){this.active=a},getActive:function(){return this.active}}})});Build("build.ui.tab.TabContainer",["build.ui.SwitcherPanel"],function(a,$super){a({$extends:"build.ui.SwitcherPanel",$constructor:function(a){$super(this)(a)},$prototype:{}})});Build("build.ui.tab.TabPanel",["build.ui.Panel"],function(a,$super){a({$extends:"build.ui.Panel",$constructor:function(a){$super(this)(a);this.title=null},$prototype:{}})});Build("build.ui.Widget",["build.ui.Module"],function(a,$super){var f={};a({$extends:"build.ui.Module",$constructor:function(a){$super(this)();this.type=a||"div";this.createElement()},$prototype:{createElement:function(){this.element=document.createElement(this.type);this.element.id=this.uniqueId();this.element.classList.add(this.uniqueClass());this.element.controller=this;this.build()},build:function(){},uniqueId:function(){var a=this.constructor.$name;f[a]=f[a]?f[a]+1:0;return Build.nameToCss(a+
"-"+f[a])},uniqueClass:function(){return Build.nameToCss(this.constructor.$name)},appendChild:function(a){this.element.appendChild(a.element)},removeChild:function(a){this.element.removeChild(a.element)}}})});module.exports=function(a){a("build.mvc.controller.Controller",[],function(a,$super){a({$constructor:function(a){this.app=a},$prototype:{route:function(a){a.verb=a.verb||"all";a.permission=a.permission||null;a.restful=a.restful||!1;if(!a.route||!a.method)throw"missing parameters in route";var b=a.permission,c=a.verb,e=a.route,g=a.method;"string"==typeof c&&(c=[c]);"string"==typeof e&&(e=[e]);for(var k=function(c,e){b?Array.isArray(b)||(b=[b]):b=[];for(var h=!0,k=0;k<b.length&&(h=(0,b[k])(c,e),h);k++);
h?a.restful?(h=function(a){e.send(a)},g(c,e,h)):(k={layout:"layout",title:"",instance:{request:c,response:e},main:{}},h=function(a,b){b.widgets?self.renderWidgets(c,e,b.widgets,function(d){b.widgets=d;e.render(a,b)}):e.render(a,b)},g(c,e,h,k)):e.send(!1)},n=0;n<e.length;n++)for(var m=e[n],l=0;l<c.length;l++)switch(c[l]){case "all":this.app.all(m,k);break;case "get":this.app.get(m,k);break;case "post":this.app.post(m,k);break;case "put":this.app.put(m,k);break;case "delete":this.app.del(m,k)}return g},
renderWidgets:function(a,b,c,e){e(c)}}})})};Build("build.mvc.controller.TestController",["node::build.mvc.controller.Controller"],function(a,$super){a({$extends:"build.mvc.controller.Controller",$constructor:function(a){$super(this)(a);this.index=this.route({verb:"all",route:"/test",permission:null,restful:!1,method:function(a,b,c,e){c("test/index",e)}});this.rest=this.route({verb:"all",route:"/test/rest",permission:null,restful:!0,method:function(a,b,c){c({value:123})}})}})});var fs=require("fs"),path=require("path"),mongo=require("mongodb"),mongoose=require("mongoose"),Server=mongo.Server,Db=mongo.Db;
module.exports=function(a){a("build.mvc.database.Database",[],function(a,$super){a({$constructor:function(a,b,c,e,g,k){this.server=this.db=null;var n=this;this.init=function(m){var l=n.initMongo(a,b,c,e,g,function(){n.initMongoose(k,function(){"function"==typeof m?m():!1})});n.db=l.db;n.server=l.server}},$prototype:{initMongo:function(a,b,c,e,g,k){a=new Server(a,b,{auto_reconnect:!0});c=new Db(c,a,{safe:!1});c.open(function(a,b){b.authenticate(e,g,function(){a?console.log("Database connection failure..."):
(console.log("Database connection success..."),k())})});return{server:a,db:c}},initMongoose:function(a,b){mongoose.connection.on("open",function(){console.log("Mongoose connection success...");b()});mongoose.connect(a)}}})})};fs=require("fs");path=require("path");module.exports=function(a){a("build.mvc.Helper",[],function(a,$super){a({$constructor:function(){},$static:{loadHelpers:function(a){var b=fs.readdirSync(a);for(x in b){var c=b[x];if(".js"==path.extname(c)){var e=path.basename(c,".js");this.load(e,a+"/"+c)}}},load:function(a,b){require(b)(system,function(b,e){system.helpers[b]=e;console.log("Added helper:  "+a)})}}})})};fs=require("fs");path=require("path");module.exports=function(a){a("build.mvc.Model",[],function(a,$super){a({$constructor:function(){},$static:{loadModels:function(a){var b=fs.readdirSync(a);for(x in b){var c=b[x];if(".js"==path.extname(c)){var e=path.basename(c,".js");this.load(e,a+"/"+c)}}},load:function(a,b){require(b)(system,function(b){system.models[a]=b;console.log("Added model:  "+a)})}}})})};module.exports=function(a){a("build.mvc.IsLoggedInPermission",[],function(a,$super){a({$constructor:function(){this.run=function(a,b){return!!a.session.user}}})})};module.exports=function(a){a("build.mvc.Permission",[],function(a,$super){a({$constructor:function(){this.run=function(a,b){return!0}}})})};var express=require("express"),expressLayouts=require("express-ejs-layouts"),engine=require("ejs-locals"),mongoStore=require("connect-mongo")(express),ejs=require("ejs");
module.exports=function(a){a("build.mvc.server.DynamicServer",["node::build.mvc.server.Server","node::build.mvc.database.Database"],function(a,$super){a({$extends:"build.mvc.server.Server",$constructor:function(a){$super(this)(a);var b=express();this.app=b;this.system={};this.system.app=b;this.system.config=a;b.configure(function(){b.engine("ejs",engine);b.set("views",a.viewPath);b.set("view engine","ejs");b.set("layout","layout");b.set("view options",{pretty:!0});b.use(express.compress());b.use(expressLayouts);
b.use(a.staticDirectory,express.static(a.staticPath));b.use(express.favicon(a.icon));b.use(express.logger("dev"));b.use(express.bodyParser());b.use(express.methodOverride());b.use(express.cookieParser(a.cookieSecret));b.use(express.session({secret:a.session.cookieSecret,store:new mongoStore(a.session.database,function(){console.log("Session database connection success...")}),maxAge:a.session.maxAge}));b.use(b.router)});b.configure("development",function(){b.use(express.errorHandler({dumpExceptions:!0,
showStack:!0}))});b.configure("production",function(){b.use(express.errorHandler())});this.database=new build.mvc.database.Database(this.config.mongodb.host,this.config.mongodb.port,this.config.mongodb.database,this.config.mongodb.username,this.config.mongodb.password,this.config.mongooseConnection)},$prototype:{start:function(a){var b=this;this.database.init(function(){b.app.listen(b.config.port,function(){console.log("Listening on port "+b.config.port);"function"==typeof a?a():!1})})}},$static:{}})})};express=require("express");
module.exports=function(a){a("build.mvc.server.FileServer",["node::build.mvc.server.Server"],function(a,$super){a({$extends:"build.mvc.server.Server",$constructor:function(a){$super(this)(a);var b=express();this.app=b;this.system={};this.system.app=b;this.system.config=a;b.configure(function(){b.use(a.staticDirectory,express.compress());b.use(a.staticDirectory,express.static(a.staticPath,{maxAge:864E5}));b.use(express.methodOverride());b.use(b.router)});b.configure("development",function(){b.use(express.errorHandler({dumpExceptions:!0,
showStack:!0}))});b.configure("production",function(){b.use(express.errorHandler())})},$prototype:{start:function(a){var b=this;this.app.listen(this.config.port,function(){console.log("Listening on port "+b.config.port);"function"==typeof a?a():!1})}},$static:{}})})};module.exports=function(a){a("build.mvc.server.Server",[],function(a,$super){a({$constructor:function(a){this.config=a;this.controllers=[]},$prototype:{start:function(a){},addController:function(a){this.controllers.push(a)}},$static:{}})})};fs=require("fs");path=require("path");
module.exports=function(a){a("build.mvc.Widget",[],function(a,$super){a({$constructor:function(){},$prototype:{render:function(a,b,c){}},$static:{loadWidgets:function(a){var b=fs.readdirSync(a);for(x in b){var c=b[x];if(".js"==path.extname(c)){var e=path.basename(c,".js");this.load(e,a+"/"+c)}}},load:function(a,b){require(b)(system,function(b,e){system.helpers[b]=e;console.log("Added widget:  "+a)},function(a,b,d){fs.readFile(system.config.viewPath+a+".ejs",function(a,c){a?"function"==typeof d?d(a):
!1:"function"==typeof d?d(null,ejs.render(c,b)):!1})})}}})})};Build("build.NodeTest",[],function(a,$super){a({$constructor:function(){console.log("NodeTest")}})});
