var build=build||{},Build=build.Build=function(){function a(c){switch(typeof c){case "function":a.onload.apply(a.onload,arguments);break;case "string":a.define.apply(a.define,arguments)}}function h(c,a){for(var b=c.split("."),d=v.root,e=d,k="",f=0,g=b.length;f<g;f++)k=b[f],d[k]=d[k]||{},e=d,d=d[k];B[b[0]]=v.root[b[0]];return e[k]=a}function k(c,a){for(var b in a)a.hasOwnProperty(b)&&(c[b]=c[b]||a[b]);return c}function c(c,a){for(var b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c}function b(a,b,
d){b?(d=d||{},Object.keys(a.prototype).length&&c(d,a.prototype),a.prototype=Object.create(b.prototype),c(a.prototype,d),a.prototype.constructor=a,k(a,b),a.$parent=b):k(a.prototype,d)}function e(c,a,d,e,f,g){$construtor=g?singletone(a):a;k(a,e);b(a,f,d);a.$name=c;w[c]=a;h(c,a);return a}function d(){for(var c=Object.keys(g);c.length;){var a=c.pop();t(a)}g={};s&&(m.queue.call(),m.queue.clear())}function t(c){var a=g[c];delete g[c];if(a){var b;a(function(a){w[a.$extends]||t(a.$extends);b=e(c,a.$constructor,
a.$prototype,a.$static,w[a.$extends],a.$singleton)},function(a){return function(){b.$parent.apply(a,Array.prototype.slice.call(arguments))}})}}function p(a){return a.replace(/\./g,"-")}function u(a,c){return a.endsWith(".js")?c+name:c+a.replace(/\./g,"/")+".js"}function n(){this.done=!1;this.queue=[]}function l(a,c){function b(){Object.keys(f).length||(d(),l.queue.call(),l.queue.clear())}l.queue.add(c);if(a instanceof Array){y+=a.length;for(var e=0,k=a.length;e<k;e++)r(a[e],function(){y--;y||b()})}else r(a,
b)}function r(a,c){var b,d=a.split("::");1<d.length?(b=z[d[0]]||z.main,a=d[1]):b=z.main;w[a]?c():(b=u(a,b),d=p(a),f[a]=!0,q(d,b,function(){delete f[a];c()}))}function q(c,b,d){switch(v.name){case "browser":var e=document.createElement("script");e.id=c;e.src=b;e.addEventListener("load",d,!1);document.getElementsByTagName("head")[0].appendChild(e);break;case "node":c=require(b),v.override&&"function"!==typeof c||c(a),d()}}function m(a){if("undefined"!=typeof jQuery)jQuery(a);else if(m.queue)m.queue.add(a);
else switch(m.queue=new n,m.queue.add(a),v.name){case "browser":window.addEventListener("load",function(){s=!0;var a=Object.keys(A);a.length?l(a,function(){d()}):d()},!1);break;case "node":d()}}var s=!1,f={},g={},z={main:"/"},A={},B={},v=function(){return"undefined"!==typeof window?{name:"browser",root:window}:"undefined"!==typeof process?(s=!0,module.exports=a,{name:"node",root:B,override:"hidden",processOverride:function(){this.root=process;this.override="process";process.Build=a},globalOverride:function(){this.root=
GLOBAL;this.override="global";GLOBAL.Build=a}}):{name:null,root:null}}(),w={};n.prototype={add:function(a){this.done?a():this.queue.push(a)},call:function(){if(!this.done){for(;this.queue.length;)this.queue.pop()();this.done=!0}},clear:function(){this.done=!1;this.queue=[]}};var y=0;l.queue=new n;m.queue=null;a.root=B;a.environment=v;a.namespace=h;a.copyReplace=c;a.copyNoReplace=k;a.inherit=b;a.singleton=function(a){var c=void 0;return function(){if(!c){var b=arguments,d=function(){return a.apply(this,
b)};d.prototype=a.prototype;c=new d}return c}};a.definitions=w;a.assemble=e;a.paths=z;a.define=function(a,c,b){s||delete A[a];for(var d=[],e=0,k=c.length;e<k;e++){var t=c[e];w[t]||(g[t]||f[t]||A[t])||d.push(t)}g[a]=b;if(d.length)if(s)l(d,function(){});else for(e=0,k=d.length;e<k;e++)A[d[e]]=!0};a.nameToCss=p;a.nameToFileName=u;a.load=l;a.loadScript=q;a.CallbackQueue=n;a.onload=m;return a}();
(function(){"function"!==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)})})();Build("build.HashRouter",[],function(a,$super){a({$constructor:function(){this.routes={}},$prototype:{handler:function(a){for(var c in routes)if(routes.hasOwnProperty(c)){var b=routes[c],e=a.newURL.match(b.regex);e&&b.enter.apply(b.enter,e.slice(1))}},listen:function(){window.addEventHandler("hashchange",this.handler)},stop:function(){window.removeEventHandler("hashchange",this.handler)},add:function(a,c,b){this.routes[a]={route:a,enter:c,exit:b,regex:RegExp(a.replace(/\//g,"\\/").replace(/:(\w*)/g,
"(\\w*)"))}},remove:function(a){delete this.routes[a]}}})});Build("build.ui.Application",["build.ui.Panel"],function(a,$super){a({$extends:"build.ui.Panel",$constructor:function(a){$super(this)(a)}})});Build("build.ui.form.Button",["build.ui.form.FormElement"],function(a,$super){a({$extends:"build.ui.form.FormElement",$constructor:function(a){$super(this)(a||"button")},$prototype:{build:function(){this.element.innerHTML="Button"}}})});Build("build.ui.form.Form",["build.ui.Panel"],function(a,$super){a({$extends:"build.ui.Panel",$constructor:function(a){$super(this)(a||"form")}})});Build("build.ui.form.FormElement",["build.ui.Widget"],function(a,$super){a({$extends:"build.ui.Widget",$constructor:function(a){$super(this)(a)},$prototype:{}})});Build("build.ui.form.Submit",["build.ui.form.Button"],function(a,$super){a({$extends:"build.ui.form.Button",$constructor:function(a){$super(this)(a||"submit")}})});Build("build.ui.Module",[],function(a,$super){a({$constructor:function(){}})});Build("build.ui.Panel",["build.ui.Widget"],function(a,$super){a({$extends:"build.ui.Widget",$constructor:function(a){$super(this)(a);this.children=[]},$prototype:{addChild:function(a){this.children.push(a);this.appendChild(a)},removeChild:function(a){this.children.splice(array.indexOf(a),1);this.removeChild(a)}}})});Build("build.ui.SwitcherPanel",["build.ui.Panel"],function(a,$super){a({$extends:"build.ui.Panel",$constructor:function(a){$super(this)(a);this.active=0},$prototype:{setActive:function(a){this.active=a},getActive:function(){return this.active}}})});Build("build.ui.tab.TabContainer",["build.ui.SwitcherPanel"],function(a,$super){a({$extends:"build.ui.SwitcherPanel",$constructor:function(a){$super(this)(a)},$prototype:{}})});Build("build.ui.tab.TabPanel",["build.ui.Panel"],function(a,$super){a({$extends:"build.ui.Panel",$constructor:function(a){$super(this)(a);this.title=null},$prototype:{}})});Build("build.ui.Widget",["build.ui.Module"],function(a,$super){var k={};a({$extends:"build.ui.Module",$constructor:function(a){$super(this)();this.type=a||"div";this.createElement()},$prototype:{createElement:function(){this.element=document.createElement(this.type);this.element.id=this.uniqueId();this.element.classList.add(this.uniqueClass());this.element.controller=this;this.build()},build:function(){},uniqueId:function(){var a=this.constructor.$name;k[a]=k[a]?k[a]+1:0;return Build.nameToCss(a+
"-"+k[a])},uniqueClass:function(){return Build.nameToCss(this.constructor.$name)},appendChild:function(a){this.element.appendChild(a.element)},removeChild:function(a){this.element.removeChild(a.element)}}})});var fs=require("fs"),path=require("path");
module.exports=function(a){a("build.mvc.Controller",[],function(h,$super){a.root.system.controllers={};h({$constructor:function(){},$prototype:{},$static:{loadControllers:function(a){var b=fs.readdirSync(a);for(x in b){var e=b[x];if(".js"==path.extname(e)){var d=path.basename(e,".js");this.load(d,a+"/"+e)}}},load:function(a,b){var e=this;require(b)(system,function(b,e,p){b.prototype=e||{};for(var h in p)b.prototype[h]=p[h];system.controllers[a]=b;console.log("Added controller:  "+a)},function(a){a.verb=
a.verb||"all";a.permission=a.permission||null;a.restful=a.restful||!1;if(!a.route||!a.method)throw"missing parameters in route";var c=a.permission,b=a.verb,h=a.route,n=a.method,l=function(b,f){c?Array.isArray(c)||(c=[c]):c=[];for(var g=0;g<c.length;g++){var h=c[g];"string"==typeof h&&(c[g]=system.permission[h])}h=!0;for(g=0;g<c.length&&(h=c[g],h=h(b,f),h);g++);h?a.restful?(g=function(a){f.send(a)},n(b,f,g)):(h={layout:"layoutMain",title:"",instance:{request:b,response:f},main:{}},g=function(a,c){c.widgets?
e.renderWidgets(b,f,c.widgets,function(b){c.widgets=b;f.render(a,c)}):f.render(a,c)},n(b,f,g,h)):f.send(!1)};"string"==typeof b&&(b=[b]);"string"==typeof h&&(h=[h]);for(var r=0;r<h.length;r++)for(var q=h[r],m=0;m<b.length;m++)switch(b[m]){case "all":system.app.all(q,l);break;case "get":system.app.get(q,l);break;case "post":system.app.post(q,l);break;case "put":system.app.put(q,l);break;case "delete":system.app.del(q,l)}return n})},renderWidgets:function(a,b,e,d){d(e)}}})})};var fs=require("fs"),path=require("path"),mongo=require("mongodb"),mongoose=require("mongoose"),Server=mongo.Server,Db=mongo.Db;
module.exports=function(a){a("build.mvc.Database",[],function(a,$super){a({$constructor:function(a,b,e,d,h){this.server=this.db=null;var p=this;this.init=function(u){var n=p.initMongo(a,b,e,d,h,function(){p.initMongoose(function(){"function"==typeof u?u():!1})});p.db=n.db;p.server=n.server}},$static:{initMongo:function(a,b,e,d,h,p){a=new Server(a,b,{auto_reconnect:!0});e=new Db(e,a,{safe:!1});e.open(function(a,c){c.authenticate(d,h,function(){a?console.log("Database connection failure..."):(console.log("Database connection success..."),
p())})});return{server:a,db:e}},initMongoose:function(a){mongoose.connection.on("open",function(){console.log("Mongoose connection success...");a()});mongoose.connect(system.config.mongooseConnection)}}})})};fs=require("fs");path=require("path");module.exports=function(a){a("build.mvc.Helper",[],function(a,$super){a({$constructor:function(){},$static:{loadHelpers:function(a){var b=fs.readdirSync(a);for(x in b){var e=b[x];if(".js"==path.extname(e)){var d=path.basename(e,".js");this.load(d,a+"/"+e)}}},load:function(a,b){require(b)(system,function(b,d){system.helpers[b]=d;console.log("Added helper:  "+a)})}}})})};fs=require("fs");path=require("path");module.exports=function(a){a("build.mvc.Model",[],function(a,$super){a({$constructor:function(){},$static:{loadModels:function(a){var b=fs.readdirSync(a);for(x in b){var e=b[x];if(".js"==path.extname(e)){var d=path.basename(e,".js");this.load(d,a+"/"+e)}}},load:function(a,b){require(b)(system,function(b){system.models[a]=b;console.log("Added model:  "+a)})}}})})};fs=require("fs");path=require("path");module.exports=function(a){a("build.mvc.Permission",[],function(a,$super){a({$constructor:function(){},$static:{loadPermissions:function(a){var b=fs.readdirSync(a);for(x in b){var e=b[x];if(".js"==path.extname(e)){var d=path.basename(e,".js");this.load(d,a+"/"+e)}}},load:function(a,b){require(b)(system,function(b,d){system.permission[b]=d;console.log("Added permission:  "+a)})}}})})};var express=require("express");
module.exports=function(a){a("build.mvc.server.DynamicServer",[],function(a,$super){a({$constructor:function(a){this.config=a;var b=express();this.app=b;this.system={};this.system.app=b;this.system.config=a;b.configure(function(){b.use(a.staticDirectory,express.compress());b.use(a.staticDirectory,express.static(a.staticPath,{maxAge:864E5}));b.use(express.methodOverride());b.use(b.router)});b.configure("development",function(){b.use(express.errorHandler({dumpExceptions:!0,showStack:!0}))});b.configure("production",
function(){b.use(express.errorHandler())})},$prototype:{start:function(){var a=this;this.app.listen(this.config.port,function(){console.log("Listening on port "+a.config.port)})},oldConstructor:function(a){function b(b){l.loadPermissions(a.permissionPath);r.loadHelpers(g.config.helperPath);q.loadWidgets(g.config.widgetPath);m.loadControllers(a.controllerPath);s.loadModels(a.modelPath);b()}function e(b){f.listen(a.port,function(){console.log("Listening on port "+a.port);"function"==typeof b?b():!1})}
var d=require("express"),h=require("express-ejs-layouts"),p=require("ejs-locals"),u=require("connect-mongo")(d);require("fs");require("path");require("url");require("ejs");require("async");var n=build.mvc.Database,l=build.mvc.Permission,r=build.mvc.Helper,q=build.mvc.Widget,m=build.mvc.Controller,s=build.mvc.Model;this.config=a=require("./config");var f=d(),g={};g.app=f;g.config=a;f.configure(function(){f.engine("ejs",p);f.set("views",a.viewPath);f.set("view engine","ejs");f.set("layout","layout");
f.set("view options",{pretty:!0});f.use(d.compress());f.use(h);f.use(a.staticDirectory,d.static(a.staticPath));f.use(d.favicon(a.icon));f.use(d.logger("dev"));f.use(d.bodyParser());f.use(d.methodOverride());f.use(d.cookieParser(a.cookieSecret));f.use(d.session({secret:a.session.cookieSecret,store:new u(a.session.database,function(){console.log("Session database connection success...")}),maxAge:a.session.maxAge}));f.use(f.router)});f.configure("development",function(){f.use(d.errorHandler({dumpExceptions:!0,
showStack:!0}))});f.configure("production",function(){f.use(d.errorHandler())});f.locals.Html={};n=n(g);l=l(g);r=r(g);q=q(g);m=m(g);s=s(g);n.initialize(function(){b(function(){e()})})}},$static:{}})})};express=require("express");
module.exports=function(a){a("build.mvc.server.FileServer",["node::build.mvc.server.Server"],function(a,$super){a({$extends:"build.mvc.server.Server",$constructor:function(a){$super(this)(a);var b=express();this.app=b;this.system={};this.system.app=b;this.system.config=a;b.configure(function(){b.use(a.staticDirectory,express.compress());b.use(a.staticDirectory,express.static(a.staticPath,{maxAge:864E5}));b.use(express.methodOverride());b.use(b.router)});b.configure("development",function(){b.use(express.errorHandler({dumpExceptions:!0,
showStack:!0}))});b.configure("production",function(){b.use(express.errorHandler())})},$prototype:{start:function(){var a=this;this.app.listen(this.config.port,function(){console.log("Listening on port "+a.config.port)})}},$static:{}})})};module.exports=function(a){a("build.mvc.server.Server",[],function(a,$super){a({$constructor:function(a){this.config=a},$prototype:{start:function(){}},$static:{}})})};fs=require("fs");path=require("path");
module.exports=function(a){a("build.mvc.Widget",[],function(a,$super){a({$constructor:function(){},$prototype:{render:function(a,b,e){}},$static:{loadWidgets:function(a){var b=fs.readdirSync(a);for(x in b){var e=b[x];if(".js"==path.extname(e)){var d=path.basename(e,".js");this.load(d,a+"/"+e)}}},load:function(a,b){require(b)(system,function(b,d){system.helpers[b]=d;console.log("Added widget:  "+a)},function(a,b,c){fs.readFile(system.config.viewPath+a+".ejs",function(a,e){a?"function"==typeof c?c(a):
!1:"function"==typeof c?c(null,ejs.render(e,b)):!1})})}}})})};Build("build.NodeTest",[],function(a,$super){a({$constructor:function(){console.log("NodeTest")}})});
