var build=build||{},Build=build.Build=function(){function a(b){switch(typeof b){case "function":a.onload.apply(a.onload,arguments);break;case "string":a.define.apply(a.define,arguments)}}function f(b,a){for(var d=b.split("."),s=t.root,g=s,c="",e=0,f=d.length;e<f;e++)c=d[e],s[c]=s[c]||{},g=s,s=s[c];C[d[0]]=t.root[d[0]];return g[c]=a}function d(b,a){for(var d in a)a.hasOwnProperty(d)&&(b[d]=b[d]||a[d]);return b}function b(b,a){for(var d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);return b}function c(a,c,
g){c?(g=g||{},Object.keys(a.prototype).length&&b(g,a.prototype),a.prototype=Object.create(c.prototype),b(a.prototype,g),a.prototype.constructor=a,d(a,c),a.$parent=c):d(a.prototype,g)}function q(a,b,g,s,e,q){$construtor=q?singletone(b):b;d(b,s);c(b,e,g);b.$name=a;u[a]=b;f(a,b);return b}function g(){for(var a=Object.keys(v);a.length;){var b=a.pop();r(b)}v={};w&&(p.queue.call(),p.queue.clear())}function r(a){var b=v[a];delete v[a];if(b){var d;b(function(b){u[b.$extends]||r(b.$extends);d=q(a,b.$constructor,
b.$prototype,b.$static,u[b.$extends],b.$singleton)},function(b){return function(){d.$parent.apply(b,Array.prototype.slice.call(arguments))}})}}function n(b){return b.replace(/\./g,"-")}function h(b,a){return b.endsWith(".js")?a+name:a+b.replace(/\./g,"/")+".js"}function m(){this.done=!1;this.queue=[]}function l(b,a){function d(){Object.keys(y).length||g();l.queue.call();l.queue.clear()}l.queue.add(a);if(b instanceof Array){z+=b.length;for(var c=0,f=b.length;c<f;c++)e(b[c],function(){z--;z||d()})}else e(b,
d)}function e(b,a){var d,c=b.split("::");1<c.length?(d=A[c[0]]||A.main,b=c[1]):d=A.main;u[b]?a():(d=h(b,d),c=n(b),y[b]=!0,k(c,d,function(){delete y[b];a()}))}function k(b,d,c){switch(t.name){case "browser":var g=document.createElement("script");g.id=b;g.src=d;g.addEventListener("load",c,!1);document.getElementsByTagName("head")[0].appendChild(g);break;case "node":b=require(d),t.override&&"function"!==typeof b||b(a),c()}}function p(b){if("undefined"!=typeof jQuery)jQuery(b);else if(p.queue)p.queue.add(b);
else switch(p.queue=new m,p.queue.add(b),t.name){case "browser":window.addEventListener("load",function(){w=!0;var b=Object.keys(B);b.length?l(b,function(){g()}):g()},!1);break;case "node":g()}}var w=!1,y={},v={},A={main:"/"},B={},C={},t=function(){return"undefined"!==typeof window?{name:"browser",root:window}:"undefined"!==typeof process?(w=!0,module.exports=a,{name:"node",root:C,override:"hidden",processOverride:function(){this.root=process;this.override="process";process.Build=a},globalOverride:function(){this.root=
GLOBAL;this.override="global";GLOBAL.Build=a}}):{name:null,root:null}}(),u={};m.prototype={add:function(b){this.done?b():this.queue.push(b)},call:function(){if(!this.done){for(;this.queue.length;)this.queue.pop()();this.done=!0}},clear:function(){this.done=!1;this.queue=[]}};var z=0;l.queue=new m;p.queue=null;a.root=C;a.environment=t;a.namespace=f;a.copyReplace=b;a.copyNoReplace=d;a.inherit=c;a.singleton=function(b){var a=void 0;return function(){if(!a){var d=arguments,c=function(){return b.apply(this,
d)};c.prototype=b.prototype;a=new c}return a}};a.definitions=u;a.assemble=q;a.paths=A;a.define=function(b,a,d){w||delete B[b];for(var c=[],g=0,e=a.length;g<e;g++){var f=a[g];u[f]||(v[f]||y[f]||B[f])||c.push(f)}v[b]=d;if(c.length)if(w)l(c,function(){});else for(g=0,e=c.length;g<e;g++)B[c[g]]=!0};a.nameToCss=n;a.nameToFileName=h;a.load=l;a.loadScript=k;a.CallbackQueue=m;a.onload=p;return a}();
(function(){"function"!==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)})})();Build("build.HashRouter",[],function(a,$super){a({$constructor:function(){this.routes={}},$prototype:{handler:function(a){for(var b in routes)if(routes.hasOwnProperty(b)){var c=routes[b],q=a.newURL.match(c.regex);q&&c.enter.apply(c.enter,q.slice(1))}},listen:function(){window.addEventHandler("hashchange",this.handler)},stop:function(){window.removeEventHandler("hashchange",this.handler)},add:function(a,b,c){this.routes[a]={route:a,enter:b,exit:c,regex:RegExp(a.replace(/\//g,"\\/").replace(/:(\w*)/g,
"(\\w*)"))}},remove:function(a){delete this.routes[a]}}})});Build("build.ui.Application",["build.ui.Panel"],function(a,$super){a({$extends:"build.ui.Panel",$constructor:function(a){$super(this)(a)}})});Build("build.ui.form.Button",["build.ui.form.FormElement"],function(a,$super){a({$extends:"build.ui.form.FormElement",$constructor:function(a){$super(this)(a||"button")},$prototype:{build:function(){this.element.innerHTML="Button"}}})});Build("build.ui.form.Form",["build.ui.Panel"],function(a,$super){a({$extends:"build.ui.Panel",$constructor:function(a){$super(this)(a||"form")}})});Build("build.ui.form.FormElement",["build.ui.Widget"],function(a,$super){a({$extends:"build.ui.Widget",$constructor:function(a){$super(this)(a)},$prototype:{}})});Build("build.ui.form.Submit",["build.ui.form.Button"],function(a,$super){a({$extends:"build.ui.form.Button",$constructor:function(a){$super(this)(a||"submit")}})});Build("build.ui.Module",[],function(a,$super){a({$constructor:function(){}})});Build("build.ui.Panel",["build.ui.Widget"],function(a,$super){a({$extends:"build.ui.Widget",$constructor:function(a){$super(this)(a);this.children=[]},$prototype:{addChild:function(a){this.children.push(a);this.appendChild(a)},removeChild:function(a){this.children.splice(array.indexOf(a),1);this.removeChild(a)}}})});Build("build.ui.SwitcherPanel",["build.ui.Panel"],function(a,$super){a({$extends:"build.ui.Panel",$constructor:function(a){$super(this)(a);this.active=0},$prototype:{setActive:function(a){this.active=a},getActive:function(){return this.active}}})});Build("build.ui.tab.TabContainer",["build.ui.SwitcherPanel"],function(a,$super){a({$extends:"build.ui.SwitcherPanel",$constructor:function(a){$super(this)(a)},$prototype:{}})});Build("build.ui.tab.TabPanel",["build.ui.Panel"],function(a,$super){a({$extends:"build.ui.Panel",$constructor:function(a){$super(this)(a);this.title=null},$prototype:{}})});Build("build.ui.Widget",["build.ui.Module"],function(a,$super){var d={};a({$extends:"build.ui.Module",$constructor:function(a){$super(this)();this.type=a||"div";this.createElement()},$prototype:{createElement:function(){this.element=document.createElement(this.type);this.element.id=this.uniqueId();this.element.classList.add(this.uniqueClass());this.element.controller=this;this.build()},build:function(){},uniqueId:function(){var a=this.constructor.$name;d[a]=d[a]?d[a]+1:0;return Build.nameToCss(a+
"-"+d[a])},uniqueClass:function(){return Build.nameToCss(this.constructor.$name)},appendChild:function(a){this.element.appendChild(a.element)},removeChild:function(a){this.element.removeChild(a.element)}}})});var fs=require("fs"),path=require("path");
module.exports=function(a){a("build.mvc.Controller",[],function(f,$super){a.root.system.controllers={};f({$constructor:function(){},$prototype:{},$static:{loadControllers:function(a){var c=fs.readdirSync(a);for(x in c){var f=c[x];if(".js"==path.extname(f)){var g=path.basename(f,".js");this.load(g,a+"/"+f)}}},load:function(a,c){var f=this;require(c)(system,function(c,f,q){c.prototype=f||{};for(var h in q)c.prototype[h]=q[h];system.controllers[a]=c;console.log("Added controller:  "+a)},function(a){a.verb=
a.verb||"all";a.permission=a.permission||null;a.restful=a.restful||!1;if(!a.route||!a.method)throw"missing parameters in route";var b=a.permission,c=a.verb,h=a.route,m=a.method,l=function(c,e){b?Array.isArray(b)||(b=[b]):b=[];for(var h=0;h<b.length;h++){var k=b[h];"string"==typeof k&&(b[h]=system.permission[k])}k=!0;for(h=0;h<b.length&&(k=b[h],k=k(c,e),k);h++);k?a.restful?(h=function(a){e.send(a)},m(c,e,h)):(k={layout:"layoutMain",title:"",instance:{request:c,response:e},main:{}},h=function(a,b){b.widgets?
f.renderWidgets(c,e,b.widgets,function(c){b.widgets=c;e.render(a,b)}):e.render(a,b)},m(c,e,h,k)):e.send(!1)};"string"==typeof c&&(c=[c]);"string"==typeof h&&(h=[h]);for(var e=0;e<h.length;e++)for(var k=h[e],p=0;p<c.length;p++)switch(c[p]){case "all":system.app.all(k,l);break;case "get":system.app.get(k,l);break;case "post":system.app.post(k,l);break;case "put":system.app.put(k,l);break;case "delete":system.app.del(k,l)}return m})},renderWidgets:function(a,c,f,g){g(f)}}})})};var fs=require("fs"),path=require("path"),mongo=require("mongodb"),mongoose=require("mongoose"),Server=mongo.Server,Db=mongo.Db;
module.exports=function(a){a("build.mvc.Database",[],function(a,$super){a({$constructor:function(a,c,f,g,r){this.server=this.db=null;var n=this;this.init=function(h){var m=n.initMongo(a,c,f,g,r,function(){n.initMongoose(function(){"function"==typeof h?h():!1})});n.db=m.db;n.server=m.server}},$static:{initMongo:function(a,c,f,g,r,n){a=new Server(a,c,{auto_reconnect:!0});f=new Db(f,a,{safe:!1});f.open(function(a,b){b.authenticate(g,r,function(){a?console.log("Database connection failure..."):(console.log("Database connection success..."),
n())})});return{server:a,db:f}},initMongoose:function(a){mongoose.connection.on("open",function(){console.log("Mongoose connection success...");a()});mongoose.connect(system.config.mongooseConnection)}}})})};fs=require("fs");path=require("path");module.exports=function(a){a.helpers={};return{loadHelpers:function(a){var d=fs.readdirSync(a);for(x in d){var b=d[x];if(".js"==path.extname(b)){var c=path.basename(b,".js");this.load(c,a+"/"+b)}}},load:function(f,d){require(d)(a,function(b,c){a.helpers[b]=c;console.log("Added helper:  "+f)})}}};fs=require("fs");path=require("path");module.exports=function(a){a.models={};return{loadModels:function(a){var d=fs.readdirSync(a);for(x in d){var b=d[x];if(".js"==path.extname(b)){var c=path.basename(b,".js");this.load(c,a+"/"+b)}}},load:function(f,d){require(d)(a,function(b){a.models[f]=b;console.log("Added model:  "+f)})}}};fs=require("fs");path=require("path");module.exports=function(a){a.permission={};return{loadPermissions:function(a){var d=fs.readdirSync(a);for(x in d){var b=d[x];if(".js"==path.extname(b)){var c=path.basename(b,".js");this.load(c,a+"/"+b)}}},load:function(f,d){require(d)(a,function(b,c){a.permission[b]=c;console.log("Added permission:  "+f)})}}};var express=require("express"),expressLayouts=require("express-ejs-layouts"),engine=require("ejs-locals"),mongoStore=require("connect-mongo")(express),fs=require("fs"),path=require("path"),url=require("url"),ejs=require("ejs"),async=require("async");
module.exports=function(a){a("build.mvc.Server","build.mvc.Database build.mvc.Permission build.mvc.Helper build.mvc.Widget build.mvc.Controller build.mvc.Model".split(" "),function(a,$super){a({$constructor:function(a){function c(c){r.loadPermissions(a.permissionPath);n.loadHelpers(k.config.helperPath);h.loadWidgets(k.config.widgetPath);m.loadControllers(a.controllerPath);l.loadModels(a.modelPath);c()}function f(c){e.listen(a.port,function(){console.log("Listening on port "+a.port);"function"==typeof c?
c():!1})}var g=build.mvc.Database,r=build.mvc.Permission,n=build.mvc.Helper,h=build.mvc.Widget,m=build.mvc.Controller,l=build.mvc.Model;this.config=a=require("./config");var e=express(),k={};k.app=e;k.config=a;e.configure(function(){e.engine("ejs",engine);e.set("views",a.viewPath);e.set("view engine","ejs");e.set("layout","layout");e.set("view options",{pretty:!0});e.use(express.compress());e.use(expressLayouts);e.use(a.staticDirectory,express.static(a.staticPath));e.use(express.favicon(a.icon));
e.use(express.logger("dev"));e.use(express.bodyParser());e.use(express.methodOverride());e.use(express.cookieParser(a.cookieSecret));e.use(express.session({secret:a.session.cookieSecret,store:new mongoStore(a.session.database,function(){console.log("Session database connection success...")}),maxAge:a.session.maxAge}));e.use(e.router)});e.configure("development",function(){e.use(express.errorHandler({dumpExceptions:!0,showStack:!0}))});e.configure("production",function(){e.use(express.errorHandler())});
e.locals.Html={};g=g(k);r=r(k);n=n(k);h=h(k);m=m(k);l=l(k);g.initialize(function(){c(function(){f()})})},$prototype:{},$static:{}})})};fs=require("fs");path=require("path");module.exports=function(a){a.widgets={render:function(a,d,b){}};return{loadWidgets:function(a){var d=fs.readdirSync(a);for(x in d){var b=d[x];if(".js"==path.extname(b)){var c=path.basename(b,".js");this.load(c,a+"/"+b)}}},load:function(f,d){require(d)(a,function(b,c){a.helpers[b]=c;console.log("Added widget:  "+f)},function(b,c,d){fs.readFile(a.config.viewPath+b+".ejs",function(a,b){a?"function"==typeof d?d(a):!1:"function"==typeof d?d(null,ejs.render(b,c)):!1})})}}};Build("build.NodeTest",[],function(a,$super){a({$constructor:function(){console.log("NodeTest")}})});
