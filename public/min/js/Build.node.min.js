var build=build||{},Build=build.Build=function(){function a(b){switch(typeof b){case "function":a.onload.apply(a.onload,arguments);break;case "string":a.define.apply(a.define,arguments)}}function k(b,c){for(var d=b.split("."),a=u.root,g=a,e="",f=0,s=d.length;f<s;f++)e=d[f],a[e]=a[e]||{},g=a,a=a[e];B[d[0]]=u.root[d[0]];return g[e]=c}function w(b,d){for(var c in d)d.hasOwnProperty(c)&&(b[c]=b[c]||d[c]);return b}function b(b,c){for(var d in c)c.hasOwnProperty(d)&&(b[d]=c[d]);return b}function c(c,d,
a){d?(a=a||{},Object.keys(c.prototype).length&&b(a,c.prototype),c.prototype=Object.create(d.prototype),b(c.prototype,a),c.prototype.constructor=c,w(c,d),c.$parent=d):w(c.prototype,a)}function g(b,d,a,g,e,f){$construtor=f?singletone(d):d;w(d,g);c(d,e,a);d.$name=b;v[b]=d;k(b,d);return d}function d(){for(var b=Object.keys(f);b.length;){var d=b.pop();s(d)}f={};r&&(m.queue.call(),m.queue.clear())}function s(b){var d=f[b];delete f[b];if(d){var c;d(function(d){v[d.$extends]||s(d.$extends);c=g(b,d.$constructor,
d.$prototype,d.$static,v[d.$extends],d.$singleton)},function(d){return function(){c.$parent.apply(d,Array.prototype.slice.call(arguments))}})}}function h(d){return d.replace(/\./g,"-")}function t(d,b){return d.endsWith(".js")?b+name:b+d.replace(/\./g,"/")+".js"}function n(){this.done=!1;this.queue=[]}function l(b,c){function a(){Object.keys(e).length||(d(),l.queue.call(),l.queue.clear())}l.queue.add(c);if(b instanceof Array){y+=b.length;for(var g=0,f=b.length;g<f;g++)q(b[g],function(){y--;y||a()})}else q(b,
a)}function q(b,d){var c,a=b.split("::");1<a.length?(c=z[a[0]]||z.main,b=a[1]):c=z.main;v[b]?d():(c=t(b,c),a=h(b),e[b]=!0,p(a,c,function(){delete e[b];d()}))}function p(b,d,c){switch(u.name){case "browser":var g=document.createElement("script");g.id=b;g.src=d;g.addEventListener("load",c,!1);document.getElementsByTagName("head")[0].appendChild(g);break;case "node":b=require(d),u.override&&"function"!==typeof b||b(a),c()}}function m(b){if("undefined"!=typeof jQuery)jQuery(b);else if(m.queue)m.queue.add(b);
else switch(m.queue=new n,m.queue.add(b),u.name){case "browser":window.addEventListener("load",function(){r=!0;var b=Object.keys(A);b.length?l(b,function(){d()}):d()},!1);break;case "node":d()}}var r=!1,e={},f={},z={main:"/"},A={},B={},u=function(){return"undefined"!==typeof window?{name:"browser",root:window}:"undefined"!==typeof process?(r=!0,module.exports=a,{name:"node",root:B,override:"hidden",processOverride:function(){this.root=process;this.override="process";process.Build=a},globalOverride:function(){this.root=
GLOBAL;this.override="global";GLOBAL.Build=a}}):{name:null,root:null}}(),v={};n.prototype={add:function(b){this.done?b():this.queue.push(b)},call:function(){if(!this.done){for(;this.queue.length;)this.queue.pop()();this.done=!0}},clear:function(){this.done=!1;this.queue=[]}};var y=0;l.queue=new n;m.queue=null;a.root=B;a.environment=u;a.namespace=k;a.copyReplace=b;a.copyNoReplace=w;a.inherit=c;a.singleton=function(b){var d=void 0;return function(){if(!d){var c=arguments,a=function(){return b.apply(this,
c)};a.prototype=b.prototype;d=new a}return d}};a.definitions=v;a.assemble=g;a.paths=z;a.define=function(b,d,c){r||delete A[b];for(var a=[],g=0,s=d.length;g<s;g++){var h=d[g];v[h]||(f[h]||e[h]||A[h])||a.push(h)}f[b]=c;if(a.length)if(r)l(a,function(){});else for(g=0,s=a.length;g<s;g++)A[a[g]]=!0};a.nameToCss=h;a.nameToFileName=t;a.load=l;a.loadScript=p;a.CallbackQueue=n;a.onload=m;return a}();
(function(){"function"!==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)})})();var fs=require("fs"),path=require("path");
module.exports=function(a){a("build.mvc.Controller",[],function(k,$super){a.root.system.controllers={};k({$constructor:function(){},$prototype:{},$static:{loadControllers:function(b){var c=fs.readdirSync(b);for(x in c){var a=c[x];if(".js"==path.extname(a)){var d=path.basename(a,".js");this.load(d,b+"/"+a)}}},load:function(b,c){var a=this;require(c)(system,function(d,c,a){d.prototype=c||{};for(var g in a)d.prototype[g]=a[g];system.controllers[b]=d;console.log("Added controller:  "+b)},function(b){b.verb=
b.verb||"all";b.permission=b.permission||null;b.restful=b.restful||!1;if(!b.route||!b.method)throw"missing parameters in route";var c=b.permission,h=b.verb,k=b.route,n=b.method,l=function(k,e){c?Array.isArray(c)||(c=[c]):c=[];for(var f=0;f<c.length;f++){var h=c[f];"string"==typeof h&&(c[f]=system.permission[h])}h=!0;for(f=0;f<c.length&&(h=c[f],h=h(k,e),h);f++);h?b.restful?(f=function(b){e.send(b)},n(k,e,f)):(h={layout:"layoutMain",title:"",instance:{request:k,response:e},main:{}},f=function(b,c){c.widgets?
a.renderWidgets(k,e,c.widgets,function(d){c.widgets=d;e.render(b,c)}):e.render(b,c)},n(k,e,f,h)):e.send(!1)};"string"==typeof h&&(h=[h]);"string"==typeof k&&(k=[k]);for(var q=0;q<k.length;q++)for(var p=k[q],m=0;m<h.length;m++)switch(h[m]){case "all":system.app.all(p,l);break;case "get":system.app.get(p,l);break;case "post":system.app.post(p,l);break;case "put":system.app.put(p,l);break;case "delete":system.app.del(p,l)}return n})},renderWidgets:function(b,c,a,d){d(a)}}})})};var fs=require("fs"),path=require("path"),mongo=require("mongodb"),mongoose=require("mongoose"),Server=mongo.Server,Db=mongo.Db;
module.exports=function(a){a("build.mvc.Database",[],function(a,$super){a({$constructor:function(b,c,a,d,k){this.server=this.db=null;var h=this;this.init=function(t){var n=h.initMongo(b,c,a,d,k,function(){h.initMongoose(function(){"function"==typeof t?t():!1})});h.db=n.db;h.server=n.server}},$static:{initMongo:function(b,c,a,d,k,h){b=new Server(b,c,{auto_reconnect:!0});a=new Db(a,b,{safe:!1});a.open(function(b,c){c.authenticate(d,k,function(){b?console.log("Database connection failure..."):(console.log("Database connection success..."),
h())})});return{server:b,db:a}},initMongoose:function(b){mongoose.connection.on("open",function(){console.log("Mongoose connection success...");b()});mongoose.connect(system.config.mongooseConnection)}}})})};fs=require("fs");path=require("path");module.exports=function(a){a("build.mvc.Helper",[],function(a,$super){a({$constructor:function(){},$static:{loadHelpers:function(b){var c=fs.readdirSync(b);for(x in c){var a=c[x];if(".js"==path.extname(a)){var d=path.basename(a,".js");this.load(d,b+"/"+a)}}},load:function(b,c){require(c)(system,function(c,a){system.helpers[c]=a;console.log("Added helper:  "+b)})}}})})};fs=require("fs");path=require("path");module.exports=function(a){a("build.mvc.Model",[],function(a,$super){a({$constructor:function(){},$static:{loadModels:function(b){var c=fs.readdirSync(b);for(x in c){var a=c[x];if(".js"==path.extname(a)){var d=path.basename(a,".js");this.load(d,b+"/"+a)}}},load:function(b,c){require(c)(system,function(c){system.models[b]=c;console.log("Added model:  "+b)})}}})})};fs=require("fs");path=require("path");module.exports=function(a){a("build.mvc.Permission",[],function(a,$super){a({$constructor:function(){},$static:{loadPermissions:function(b){var c=fs.readdirSync(b);for(x in c){var a=c[x];if(".js"==path.extname(a)){var d=path.basename(a,".js");this.load(d,b+"/"+a)}}},load:function(b,c){require(c)(system,function(c,a){system.permission[c]=a;console.log("Added permission:  "+b)})}}})})};var express=require("express");
module.exports=function(a){a("build.mvc.server.DynamicServer",[],function(a,$super){a({$constructor:function(b){this.config=b;var a=express();this.app=a;this.system={};this.system.app=a;this.system.config=b;a.configure(function(){a.use(b.staticDirectory,express.compress());a.use(b.staticDirectory,express.static(b.staticPath,{maxAge:864E5}));a.use(express.methodOverride());a.use(a.router)});a.configure("development",function(){a.use(express.errorHandler({dumpExceptions:!0,showStack:!0}))});a.configure("production",
function(){a.use(express.errorHandler())})},$prototype:{start:function(){var b=this;this.app.listen(this.config.port,function(){console.log("Listening on port "+b.config.port)})},oldConstructor:function(b){function a(c){l.loadPermissions(b.permissionPath);q.loadHelpers(f.config.helperPath);p.loadWidgets(f.config.widgetPath);m.loadControllers(b.controllerPath);r.loadModels(b.modelPath);c()}function g(a){e.listen(b.port,function(){console.log("Listening on port "+b.port);"function"==typeof a?a():!1})}
var d=require("express"),k=require("express-ejs-layouts"),h=require("ejs-locals"),t=require("connect-mongo")(d);require("fs");require("path");require("url");require("ejs");require("async");var n=build.mvc.Database,l=build.mvc.Permission,q=build.mvc.Helper,p=build.mvc.Widget,m=build.mvc.Controller,r=build.mvc.Model;this.config=b=require("./config");var e=d(),f={};f.app=e;f.config=b;e.configure(function(){e.engine("ejs",h);e.set("views",b.viewPath);e.set("view engine","ejs");e.set("layout","layout");
e.set("view options",{pretty:!0});e.use(d.compress());e.use(k);e.use(b.staticDirectory,d.static(b.staticPath));e.use(d.favicon(b.icon));e.use(d.logger("dev"));e.use(d.bodyParser());e.use(d.methodOverride());e.use(d.cookieParser(b.cookieSecret));e.use(d.session({secret:b.session.cookieSecret,store:new t(b.session.database,function(){console.log("Session database connection success...")}),maxAge:b.session.maxAge}));e.use(e.router)});e.configure("development",function(){e.use(d.errorHandler({dumpExceptions:!0,
showStack:!0}))});e.configure("production",function(){e.use(d.errorHandler())});e.locals.Html={};n=n(f);l=l(f);q=q(f);p=p(f);m=m(f);r=r(f);n.initialize(function(){a(function(){g()})})}},$static:{}})})};express=require("express");
module.exports=function(a){a("build.mvc.server.FileServer",["node::build.mvc.server.Server"],function(a,$super){a({$extends:"build.mvc.server.Server",$constructor:function(b){$super(this)(b);var a=express();this.app=a;this.system={};this.system.app=a;this.system.config=b;a.configure(function(){a.use(b.staticDirectory,express.compress());a.use(b.staticDirectory,express.static(b.staticPath,{maxAge:864E5}));a.use(express.methodOverride());a.use(a.router)});a.configure("development",function(){a.use(express.errorHandler({dumpExceptions:!0,
showStack:!0}))});a.configure("production",function(){a.use(express.errorHandler())})},$prototype:{start:function(){var a=this;this.app.listen(this.config.port,function(){console.log("Listening on port "+a.config.port)})}},$static:{}})})};module.exports=function(a){a("build.mvc.server.Server",[],function(a,$super){a({$constructor:function(a){this.config=a},$prototype:{start:function(){}},$static:{}})})};fs=require("fs");path=require("path");
module.exports=function(a){a("build.mvc.Widget",[],function(a,$super){a({$constructor:function(){},$prototype:{render:function(a,c,g){}},$static:{loadWidgets:function(a){var c=fs.readdirSync(a);for(x in c){var g=c[x];if(".js"==path.extname(g)){var d=path.basename(g,".js");this.load(d,a+"/"+g)}}},load:function(a,c){require(c)(system,function(c,d){system.helpers[c]=d;console.log("Added widget:  "+a)},function(a,b,c){fs.readFile(system.config.viewPath+a+".ejs",function(a,g){a?"function"==typeof c?c(a):
!1:"function"==typeof c?c(null,ejs.render(g,b)):!1})})}}})})};Build("build.NodeTest",[],function(a,$super){a({$constructor:function(){console.log("NodeTest")}})});
