var build=build||{},Build=build.Build=function(){function a(b){switch(typeof b){case "function":a.onload.apply(a.onload,arguments);break;case "string":a.define.apply(a.define,arguments)}}function f(b,c){for(var a=b.split("."),d=n.root,e=d,f="",g=0,t=a.length;g<t;g++)f=a[g],d[f]=d[f]||{},e=d,d=d[f];z[a[0]]=n.root[a[0]];return e[f]=c}function s(b,c){for(var a in c)c.hasOwnProperty(a)&&(b[a]=b[a]||c[a]);return b}function c(b,c){for(var a in c)c.hasOwnProperty(a)&&(b[a]=c[a]);return b}function b(b,a,
d){a?(d=d||{},Object.keys(b.prototype).length&&c(d,b.prototype),b.prototype=Object.create(a.prototype),c(b.prototype,d),b.prototype.constructor=b,s(b,a),b.$parent=a):s(b.prototype,d)}function d(c,a,d,C,e,g){$construtor=g?singletone(a):a;s(a,C);b(a,e,d);a.$name=c;p[c]=a;f(c,a);return a}function e(){for(var b=Object.keys(q);b.length;){var c=b.pop();t(c)}q={};r&&(g.queue.call(),g.queue.clear())}function t(b){var c=q[b];delete q[b];if(c){var a;c(function(c){p[c.$extends]||t(c.$extends);a=d(b,c.$constructor,
c.$prototype,c.$static,p[c.$extends],c.$singleton)},function(b){return function(){a.$parent.apply(b,Array.prototype.slice.call(arguments))}})}}function h(b){return b.replace(/\./g,"-")}function m(b,c){return b.endsWith(".js")?c+name:c+b.replace(/\./g,"/")+".js"}function l(){this.done=!1;this.queue=[]}function k(b,c){function a(){Object.keys(u).length||(e(),k.queue.call(),k.queue.clear())}k.queue.add(c);if(b instanceof Array){v+=b.length;for(var d=0,f=b.length;d<f;d++)A(b[d],function(){v--;v||a()})}else A(b,
a)}function A(b,c){var a,d=b.split("::");1<d.length?(a=w[d[0]]||w.main,b=d[1]):a=w.main;p[b]?c():(a=m(b,a),d=h(b),u[b]=!0,B(d,a,function(){delete u[b];c()}))}function B(b,c,d){switch(n.name){case "browser":var e=document.createElement("script");e.id=b;e.src=c;e.addEventListener("load",d,!1);document.getElementsByTagName("head")[0].appendChild(e);break;case "node":b=require(c),n.override&&"function"!==typeof b||b(a),d()}}function g(b){if("undefined"!=typeof jQuery)jQuery(b);else if(g.queue)g.queue.add(b);
else switch(g.queue=new l,g.queue.add(b),n.name){case "browser":window.addEventListener("load",function(){r=!0;var b=Object.keys(y);b.length?k(b,function(){e()}):e()},!1);break;case "node":e()}}var r=!1,u={},q={},w={main:"/"},y={},z={},n=function(){return"undefined"!==typeof window?{name:"browser",root:window}:"undefined"!==typeof process?(r=!0,module.exports=a,{name:"node",root:z,override:"hidden",processOverride:function(){this.root=process;this.override="process";process.Build=a},globalOverride:function(){this.root=
GLOBAL;this.override="global";GLOBAL.Build=a}}):{name:null,root:null}}(),p={};l.prototype={add:function(b){this.done?b():this.queue.push(b)},call:function(){if(!this.done){for(;this.queue.length;)this.queue.pop()();this.done=!0}},clear:function(){this.done=!1;this.queue=[]}};var v=0;k.queue=new l;g.queue=null;a.root=z;a.environment=n;a.namespace=f;a.copyReplace=c;a.copyNoReplace=s;a.inherit=b;a.singleton=function(b){var c=void 0;return function(){if(!c){var a=arguments,d=function(){return b.apply(this,
a)};d.prototype=b.prototype;c=new d}return c}};a.definitions=p;a.assemble=d;a.paths=w;a.define=function(b,c,a){r||delete y[b];for(var d=[],e=0,f=c.length;e<f;e++){var g=c[e];p[g]||(q[g]||u[g]||y[g])||d.push(g)}q[b]=a;if(d.length)if(r)k(d,function(){});else for(e=0,f=d.length;e<f;e++)y[d[e]]=!0};a.nameToCss=h;a.nameToFileName=m;a.load=k;a.loadScript=B;a.CallbackQueue=l;a.onload=g;return a}();
(function(){"function"!==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)})})();module.exports=function(a){a("build.mvc.controller.Controller",[],function(a,$super){a({$constructor:function(c){this.app=c},$prototype:{route:function(c){c.verb=c.verb||"all";c.permission=c.permission||null;c.restful=c.restful||!1;if(!c.route||!c.method)throw"missing parameters in route";var b=c.permission,a=c.verb,e=c.route,f=c.method;"string"==typeof a&&(a=[a]);"string"==typeof e&&(e=[e]);for(var h=function(a,d){b?Array.isArray(b)||(b=[b]):b=[];for(var e=!0,h=0;h<b.length&&(e=(0,b[h])(a,d),e);h++);
e?c.restful?(e=function(b){d.send(b)},f(a,d,e)):(h={layout:"layout",title:"",instance:{request:a,response:d},main:{}},e=function(b,c){c.widgets?self.renderWidgets(a,d,c.widgets,function(a){c.widgets=a;d.render(b,c)}):d.render(b,c)},f(a,d,e,h)):d.send(!1)},m=0;m<e.length;m++)for(var l=e[m],k=0;k<a.length;k++)switch(a[k]){case "all":this.app.all(l,h);break;case "get":this.app.get(l,h);break;case "post":this.app.post(l,h);break;case "put":this.app.put(l,h);break;case "delete":this.app.del(l,h)}return f},
renderWidgets:function(c,b,a,e){e(a)}}})})};Build("build.mvc.controller.TestController",["node::build.mvc.controller.Controller"],function(a,$super){a({$extends:"build.mvc.controller.Controller",$constructor:function(a){$super(this)(a);this.index=this.route({verb:"all",route:"/test",permission:null,restful:!1,method:function(c,b,a,e){a("test/index",e)}});this.rest=this.route({verb:"all",route:"/test/rest",permission:null,restful:!0,method:function(c,b,a){a({value:123})}})}})});var fs=require("fs"),path=require("path"),mongo=require("mongodb"),mongoose=require("mongoose"),Server=mongo.Server,Db=mongo.Db;
module.exports=function(a){a("build.mvc.database.Database",[],function(a,$super){a({$constructor:function(c,b,a,e,f,h){this.server=this.db=null;var m=this;this.init=function(l){var k=m.initMongo(c,b,a,e,f,function(){m.initMongoose(h,function(){"function"==typeof l?l():!1})});m.db=k.db;m.server=k.server}},$prototype:{initMongo:function(c,b,a,e,f,h){c=new Server(c,b,{auto_reconnect:!0});a=new Db(a,c,{safe:!1});a.open(function(b,a){a.authenticate(e,f,function(){b?console.log("Database connection failure..."):
(console.log("Database connection success..."),h())})});return{server:c,db:a}},initMongoose:function(a,b){mongoose.connection.on("open",function(){console.log("Mongoose connection success...");b()});mongoose.connect(a)}}})})};fs=require("fs");path=require("path");module.exports=function(a){a("build.mvc.Helper",[],function(a,$super){a({$constructor:function(){},$static:{loadHelpers:function(a){var b=fs.readdirSync(a);for(x in b){var d=b[x];if(".js"==path.extname(d)){var e=path.basename(d,".js");this.load(e,a+"/"+d)}}},load:function(a,b){require(b)(system,function(b,e){system.helpers[b]=e;console.log("Added helper:  "+a)})}}})})};fs=require("fs");path=require("path");module.exports=function(a){a("build.mvc.Model",[],function(a,$super){a({$constructor:function(){},$static:{loadModels:function(a){var b=fs.readdirSync(a);for(x in b){var d=b[x];if(".js"==path.extname(d)){var e=path.basename(d,".js");this.load(e,a+"/"+d)}}},load:function(a,b){require(b)(system,function(b){system.models[a]=b;console.log("Added model:  "+a)})}}})})};module.exports=function(a){a("build.mvc.IsLoggedInPermission",[],function(a,$super){a({$constructor:function(){this.run=function(a,b){return!!a.session.user}}})})};module.exports=function(a){a("build.mvc.Permission",[],function(a,$super){a({$constructor:function(){this.run=function(a,b){return!0}}})})};var express=require("express"),expressLayouts=require("express-ejs-layouts"),engine=require("ejs-locals"),mongoStore=require("connect-mongo")(express),ejs=require("ejs");
module.exports=function(a){a("build.mvc.server.DynamicServer",["node::build.mvc.server.Server","node::build.mvc.database.Database"],function(a,$super){a({$extends:"build.mvc.server.Server",$constructor:function(a){$super(this)(a);var b=express();this.app=b;this.system={};this.system.app=b;this.system.config=a;b.configure(function(){b.engine("ejs",engine);b.set("views",a.viewPath);b.set("view engine","ejs");b.set("layout","layout");b.set("view options",{pretty:!0});b.use(express.compress());b.use(expressLayouts);
b.use(a.staticDirectory,express.static(a.staticPath));b.use(express.favicon(a.icon));b.use(express.logger("dev"));b.use(express.bodyParser());b.use(express.methodOverride());b.use(express.cookieParser(a.cookieSecret));b.use(express.session({secret:a.session.cookieSecret,store:new mongoStore(a.session.database,function(){console.log("Session database connection success...")}),maxAge:a.session.maxAge}));b.use(b.router)});b.configure("development",function(){b.use(express.errorHandler({dumpExceptions:!0,
showStack:!0}))});b.configure("production",function(){b.use(express.errorHandler())});this.database=new build.mvc.database.Database(this.config.mongodb.host,this.config.mongodb.port,this.config.mongodb.database,this.config.mongodb.username,this.config.mongodb.password,this.config.mongooseConnection)},$prototype:{start:function(a){var b=this;this.database.init(function(){b.app.listen(b.config.port,function(){console.log("Listening on port "+b.config.port);"function"==typeof a?a():!1})})}},$static:{}})})};express=require("express");
module.exports=function(a){a("build.mvc.server.FileServer",["node::build.mvc.server.Server"],function(a,$super){a({$extends:"build.mvc.server.Server",$constructor:function(a){$super(this)(a);var b=express();this.app=b;this.system={};this.system.app=b;this.system.config=a;b.configure(function(){b.use(a.staticDirectory,express.compress());b.use(a.staticDirectory,express.static(a.staticPath,{maxAge:864E5}));b.use(express.methodOverride());b.use(b.router)});b.configure("development",function(){b.use(express.errorHandler({dumpExceptions:!0,
showStack:!0}))});b.configure("production",function(){b.use(express.errorHandler())})},$prototype:{start:function(a){var b=this;this.app.listen(this.config.port,function(){console.log("Listening on port "+b.config.port);"function"==typeof a?a():!1})}},$static:{}})})};module.exports=function(a){a("build.mvc.server.Server",[],function(a,$super){a({$constructor:function(a){this.config=a;this.controllers=[]},$prototype:{start:function(a){},addController:function(a){this.controllers.push(a)}},$static:{}})})};fs=require("fs");path=require("path");
module.exports=function(a){a("build.mvc.Widget",[],function(a,$super){a({$constructor:function(){},$prototype:{render:function(a,b,d){}},$static:{loadWidgets:function(a){var b=fs.readdirSync(a);for(x in b){var d=b[x];if(".js"==path.extname(d)){var e=path.basename(d,".js");this.load(e,a+"/"+d)}}},load:function(a,b){require(b)(system,function(b,e){system.helpers[b]=e;console.log("Added widget:  "+a)},function(a,b,c){fs.readFile(system.config.viewPath+a+".ejs",function(a,d){a?"function"==typeof c?c(a):
!1:"function"==typeof c?c(null,ejs.render(d,b)):!1})})}}})})};Build("build.NodeTest",[],function(a,$super){a({$constructor:function(){console.log("NodeTest")}})});
